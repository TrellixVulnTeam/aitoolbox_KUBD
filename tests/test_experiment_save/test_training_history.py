import unittest

from tests.test_torchtrain.utils import *

from AIToolbox.experiment_save.training_history import TrainingHistory


class TestTrainingHistory(unittest.TestCase):
    def test_abstract_callback_has_hook_methods(self):
        history = {'val_loss': [2.2513437271118164, 2.1482439041137695, 2.0187528133392334, 1.7953970432281494,
                                1.5492324829101562, 1.715561032295227, 1.631982684135437, 1.3721977472305298,
                                1.039527416229248, 0.9796673059463501],
                   'val_acc': [0.25999999046325684, 0.36000001430511475, 0.5, 0.5400000214576721, 0.5400000214576721,
                               0.5799999833106995, 0.46000000834465027, 0.699999988079071, 0.7599999904632568,
                               0.7200000286102295],
                   'loss': [2.3088033199310303, 2.2141530513763428, 2.113713264465332, 1.912109375, 1.666761875152588,
                            1.460097312927246, 1.6031768321990967, 1.534214973449707, 1.1710081100463867,
                            0.8969314098358154],
                   'acc': [0.07999999821186066, 0.33000001311302185, 0.3100000023841858, 0.5299999713897705,
                           0.5799999833106995, 0.6200000047683716, 0.4300000071525574, 0.5099999904632568,
                           0.6700000166893005, 0.7599999904632568]}
        epoch = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
        train_hist = TrainingHistory(history, epoch)

        self.assertEqual(train_hist.train_history_dict,
                         {'history': history, 'epoch': epoch})
        self.assertEqual(train_hist.get_train_history(),
                         {'history': history, 'epoch': epoch})
        
    def test_trigger_exception_history_records(self):
        history = {'val_loss': [2.2513437271118164, 2.1482439041137695, 2.0187528133392334, 1.7953970432281494,
                                1.5492324829101562, 1.715561032295227, 1.631982684135437, 1.3721977472305298,
                                1.039527416229248, 0.9796673059463501],
                   'val_acc': [0.25999999046325684, 0.36000001430511475, 0.5, 0.5400000214576721, 0.5400000214576721,
                               0.5799999833106995, 0.46000000834465027],
                   'loss': [2.3088033199310303, 2.2141530513763428, 2.113713264465332, 1.912109375, 1.666761875152588,
                            1.460097312927246, 1.6031768321990967, 1.534214973449707, 1.1710081100463867,
                            0.8969314098358154],
                   'acc': [0.07999999821186066, 0.33000001311302185, 0.3100000023841858, 0.5299999713897705,
                           0.5799999833106995, 0.6200000047683716, 0.4300000071525574, 0.5099999904632568,
                           0.6700000166893005, 0.7599999904632568]}
        epoch = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
        train_hist = TrainingHistory(history, epoch, strict_content_check=True)

        with self.assertRaises(ValueError):
            train_hist.qa_check_history_records()

        train_hist.train_history_dict = None

        with self.assertRaises(ValueError):
            train_hist.get_train_history()
